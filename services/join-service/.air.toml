# join-service/air.toml
root = "."
testdata_dir = "testdata"
tmp_dir = "tmp"

[build]
  # Build only the explicit main entry file
  # (avoids problems caused by multi-package or non-standard /cmd layouts when using `go build .`)
  cmd = "go build -o ./tmp/main.exe ./api/cmd/main.go"

  # Windows executable output path
  bin = "tmp\\main.exe"

  # Only watch the directories that actually contain code
  # (reduces unnecessary rebuilds and file system scans)
  include_dir = ["api", "internal"]

  # File extensions that trigger rebuilds
  # Go source + template files
  include_ext = ["go", "tpl", "tmpl", "html"]

  # ".env" does NOT have the extension "env"
  # It has no extension â€” its full name is ".env"
  # Therefore it must be listed explicitly here
  include_file = [".env"]

  # Directories that should never trigger rebuilds
  exclude_dir = ["assets", "tmp", "vendor", "testdata", "migrations"]

  # Exclude Go test files from triggering rebuilds
  exclude_regex = ["_test.go"]

  # Debounce delay (milliseconds) before rebuilding after a file change
  delay = 1000

  # If the build fails, do NOT keep running the previous binary
  # This prevents debugging against stale code
  stop_on_error = true

  # Send SIGINT (Ctrl+C) to the old process instead of killing it
  # Allows graceful shutdown (close ports, DB connections, etc.)
  send_interrupt = true

  # After SIGINT, wait 2 seconds before force killing the process
  kill_delay = "2s"

  # Do not auto-rerun the binary after exit
  rerun = false
  rerun_delay = 500

[color]
  build = "yellow"
  main = "magenta"
  runner = "green"
  watcher = "cyan"

[log]
  main_only = false
  silent = false
  time = false

[misc]
  # Remove tmp files when Air exits
  clean_on_exit = true

[screen]
  # Do not clear the terminal on every rebuild
  clear_on_rebuild = false

  # Keep scrollback instead of wiping previous output
  keep_scroll = true
